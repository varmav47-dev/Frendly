<!DOCTYPE html>
<html>
<head>
  <title>Friendly Chat</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

<h2>Friendly Chat ðŸ’¬</h2>
<div id="online">Online users: 0</div>
<div id="status">Looking for stranger...</div>
<div id="typing"></div>

<div id="chat"></div>

<input id="msg" placeholder="Type message..." />
<button onclick="sendMsg()">Send</button>
<br>
<button onclick="nextUser()">Next</button>

<script src="/socket.io/socket.io.js"></script>
<script>
const socket = io();
const chat = document.getElementById("chat");
const typingDiv = document.getElementById("typing");

let typingTimeout;

// RECEIVE MESSAGE
socket.on("message", msg => {
  const div = document.createElement("div");
  div.className = "msg stranger";
  div.innerText = msg;
  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;
});

// SEND MESSAGE
function sendMsg() {
  const input = document.getElementById("msg");
  if (!input.value) return;

  const div = document.createElement("div");
  div.className = "msg me";
  div.innerText = input.value;
  chat.appendChild(div);

  socket.emit("message", input.value);
  input.value = "";
  chat.scrollTop = chat.scrollHeight;
}

// TYPING SEND
document.getElementById("msg").addEventListener("input", () => {
  socket.emit("typing");
});

// TYPING RECEIVE
socket.on("typing", () => {
  typingDiv.innerText = "Stranger is typing...";
  clearTimeout(typingTimeout);
  typingTimeout = setTimeout(() => {
    typingDiv.innerText = "";
  }, 1000);
});

// NEXT
function nextUser() {
  chat.innerHTML = "";
  socket.emit("next");
}
</script>

</body>
  </html>
