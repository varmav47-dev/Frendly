<!DOCTYPE html>
<html>
<head>
  <title>Friendly Chat</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <h2>Friendly Chat ğŸ’¬</h2>

  <div id="online">Online users: 0</div>
  <div id="status">Connecting...</div>
  <div id="typing"></div>

  <div id="chat"></div>

  <input type="text" id="msg" placeholder="Type message..." />
  <button id="sendBtn">Send</button>

  <button id="nextBtn">Next</button>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();

    const status = document.getElementById("status");
    const chat = document.getElementById("chat");
    const msgInput = document.getElementById("msg");
    const sendBtn = document.getElementById("sendBtn");
    const nextBtn = document.getElementById("nextBtn");
    const onlineDiv = document.getElementById("online");
    const typingDiv = document.getElementById("typing");

    socket.on("online-count", (count) => {
      onlineDiv.innerText = "Online users: " + count;
    });

    socket.on("waiting", () => {
      status.innerText = "Looking for stranger...";
      typingDiv.innerText = "";
      chat.innerHTML = "";
    });

    socket.on("matched", () => {
      status.innerText = "Connected to stranger";
      typingDiv.innerText = "";
      chat.innerHTML = "";
    });

    socket.on("message", (msg) => {
      typingDiv.innerText = "";
      const div = document.createElement("div");
      div.innerText = "Stranger: " + msg;
      chat.appendChild(div);
    });

    socket.on("typing", () => {
      typingDiv.innerText = "Stranger is typing...";
    });

    socket.on("stop-typing", () => {
      typingDiv.innerText = "";
    });

    socket.on("disconnected", () => {
      status.innerText = "Stranger disconnected";
      typingDiv.innerText = "";
    });

    msgInput.oninput = () => {
      socket.emit("typing");
      setTimeout(() => {
        socket.emit("stop-typing");
      }, 800);
    };

    sendBtn.onclick = () => {
      if (msgInput.value.trim() !== "") {
        const div = document.createElement("div");
        div.innerText = "Me: " + msgInput.value;
        chat.appendChild(div);

        socket.emit("message", msgInput.value);
        msgInput.value = "";
        socket.emit("stop-typing");
      }
    };

    nextBtn.onclick = () => {
      socket.emit("next");
    };
  </script>

</body>
</html>
